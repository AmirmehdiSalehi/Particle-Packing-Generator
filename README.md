# Random Packing Generator

This project implements a Random Sequential Addition (RSA) based algorithm for generating random packings of non-spherical particles with tunable topology. The algorithm creates irregularly shaped particles by clustering spheres in three distinct stages, allowing for control over particle shape, surface roughness, and inter-particle connectivity.

## Features

- Creation of non-spherical particles by clustering spheres in three layers
- Control over particle shape, surface roughness, and connectivity
- Efficient spatial indexing for contact detection using R*-trees (libspatialindex)
- 3D voxel representation for visual output
- Export of 3D data as TIFF stacks
- Analysis of packing properties (density, coordination number, sphericity)
- Python bindings for easy integration with data analysis tools

## Prerequisites

- CMake 3.14+
- C++14 compatible compiler
- libspatialindex (for efficient spatial indexing)
- libtiff (for saving 3D data as TIFF stacks)
- Python 3.6+ (for Python bindings)
- pybind11 (for Python bindings)
- NumPy and Matplotlib (for Python examples)

## Building the Project

```bash
# Clone the repository
git clone https://github.com/yourusername/random-packing-generator.git
cd random-packing-generator

# Create a build directory
mkdir build
cd build

# Configure with CMake
cmake ..

# Build the project
cmake --build .

# Install (optional)
cmake --install .
```

### Build Options

You can customize the build with the following CMake options:

- `BUILD_PYTHON_BINDINGS`: Build Python bindings (default: ON)
- `BUILD_EXAMPLES`: Build example programs (default: ON)

Example:
```bash
cmake .. -DBUILD_PYTHON_BINDINGS=OFF -DBUILD_EXAMPLES=ON
```

## Using the C++ Library

Here's a simple example of how to use the PackingGenerator:

```cpp
#include "PackingGenerator.h"
#include <iostream>

int main() {
    // Create a packing generator
    Packing::PackingGenerator generator(
        300,        // Domain size
        30, 40,     // Core radius range
        20, 30,     // Secondary radius range
        5, 10,      // Tertiary radius range
        0.1,        // Tertiary volume fraction
        0.65,       // Target density
        0.5         // Compactness factor
    );
    
    // Generate the packing
    generator.generate();
    
    // Report stats
    std::cout << "Particle count: " << generator.getParticleCount() << std::endl;
    std::cout << "Density: " << generator.getCurrentDensity() << std::endl;
    std::cout << "Average coordination number: " << generator.getAverageCoordinationNumber() << std::endl;
    std::cout << "Average sphericity: " << generator.getAverageSphericity() << std::endl;
    
    // Save output
    generator.saveTIFF("packing.tiff", false);
    
    return 0;
}
```

## Using the Python Bindings

After building with Python bindings enabled, you can use the library from Python:

```python
import particle_packing as pp
import numpy as np
import matplotlib.pyplot as plt

# Create a packing generator
generator = pp.PackingGenerator(
    300,        # Domain size
    30, 40,     # Core radius range
    20, 30,     # Secondary radius range
    5, 10,      # Tertiary radius range
    0.1,        # Tertiary volume fraction
    0.65,       # Target density
    0.5         # Compactness factor
)

# Generate the packing
generator.generate()

# Get statistics
print(f"Particles: {generator.getParticleCount()}")
print(f"Density: {generator.getCurrentDensity():.4f}")
print(f"Contacts: {generator.getContactCount()}")
print(f"Avg. coordination: {generator.getAverageCoordinationNumber():.2f}")
print(f"Avg. sphericity: {generator.getAverageSphericity():.4f}")

# Save to TIFF file
generator.saveTIFF("packing.tiff", True)

# Plot coordination number distribution
coord_numbers = generator.getCoordinationNumbers()
plt.hist(coord_numbers, bins=range(min(coord_numbers), max(coord_numbers) + 2), alpha=0.7)
plt.xlabel('Coordination Number')
plt.ylabel('Frequency')
plt.title('Particle Coordination Number Distribution')
plt.grid(alpha=0.3)
plt.show()
```

## Example Script

The repository includes an example Python script `packing_generator_example.py` that demonstrates how to create, analyze, and visualize particle packings:

```bash
# Run the example script
python packing_generator_example.py
```

This will:
1. Generate a random packing of non-spherical particles
2. Save the packing as a TIFF file
3. Analyze the packing properties
4. Create plots of coordination number distribution, sphericity vs. coordination, etc.
5. Visualize a few example particles in 3D

## Visualizing the Results

The TIFF files generated by the library contain 3D data that can be visualized using:

- [ImageJ](https://imagej.nih.gov/ij/) with the [3D Viewer](https://imagej.net/plugins/3d-viewer) plugin
- [ParaView](https://www.paraview.org/)
- [Python's tifffile](https://pypi.org/project/tifffile/) combined with [Matplotlib](https://matplotlib.org/) or [VTK](https://vtk.org/)

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Acknowledgments

This implementation is based on the research paper "A Random Sequential Addition-based Algorithm for Generating Random Packings of Non-spherical Particles with Tunable Topology" by Amirmehdi Salehi and Gholamreza Pircheraghi.